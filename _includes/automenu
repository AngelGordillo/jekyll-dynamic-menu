{% capture pass_stash %}{{ pass_stash }}{% if pass_active %}1{% else %}0{% endif %}{% endcapture %}{% assign pass_active = false %}{% capture menu_inside %}{% assign _pages = site.pages %}{% if include.sort %}{% assign _pages = _pages | sort: include.sort %}{% else %}{% assign _pages = _pages | sort: "url" %}{% endif %}{% if include.reverse %}{% assign _pages = _pages | reverse %}{% endif %}{% for node in _pages %}{% unless node.title %}{% continue %}{% endunless %}{% assign url_start = node.url | truncate: include.url.size, "" %}{% unless include.url == url_start %}{% continue %}{% endunless %}{% assign url_rest = node.url | remove_first: url_start %}{% assign url_rest_size = url_rest | split: "/" | size %}{% assign lastchar = node.url | split: "" | last %}{% assign nexturl = node.url %}{% if url_rest_size == 0 %}{% unless include.url == "/" %}{% continue %}{% endunless %}{% elsif lastchar == "/" %}{% unless url_rest_size == 1 %}{% continue %}{% endunless %}{% elsif url_rest_size == 2 %}{% assign filename = url_rest | split: "/" | last %}{% assign checkindex = filename | truncate: 6, "" %}{% unless checkindex == "index." %}{% continue %}{% endunless %}{% assign nexturl = node.url.size | minus: filename.size %}{% assign nexturl = node.url | truncate: nexturl, "" %}{% else %}{% unless url_rest_size == 1 and include.url == "/" %}{% continue %}{% endunless %}{% endif %}{% assign retval = false %}{% assign childmenu = "" %}{% unless node.url == "/" %}{% capture childmenu %}{% include automenu url=nexturl sort=include.sort reverse=include.reverse all=include.all %}{% endcapture %}{% endunless %}{% capture classes %}{% if page.url == node.url %}selected{{ " " }}{% elsif retval %}active{{ " " }}{% endif %}{% if childmenu != "" %}branch{{ " " }}{% if retval or page.url == node.url or include.all %}open{% else %}closed{% endif %}{% else %}leaf{% endif %}{% endcapture %}<li class="{{ classes }}"><a href="{{ site.baseurl }}{{node.url}}">{{ node.title | escape }}</a>{% if retval or page.url == node.url or include.all %}{{childmenu}}{% endif %}{% if retval or page.url == node.url %}{% assign pass_active = true %}{% endif %}</li>{% endfor %}{% endcapture %}{% unless menu_inside == "" %}<ul class="menu">{{ menu_inside }}</ul>{% endunless %}{% assign retval = pass_active %}{% assign new_active = pass_stash | split: "" | last %}{% if new_active == "1" %}{% assign pass_active = true %}{% else %}{% assign pass_active = false %}{% endif %}{% assign new_active = pass_stash.size | minus: 1 %}{% assign pass_stash = pass_stash | truncate: new_active, "" %}